<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SEKIGACHA</title>

  <!-- アプリアイコン -->
  <link rel="apple-touch-icon" href="icons/icon-180.png" />
  <link rel="manifest" href="manifest.json" />

  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "Segoe UI", system-ui, sans-serif;
      color-scheme: light;
    }
    body {
      margin: 0;
      background: #ffffff;
      display: flex;
      justify-content: center;
    }

    .app {
      width: 100%;
      max-width: 400px;
      padding: 24px 16px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .logo img { width: 240px; }

    .svg-wrapper { width: 320px; }
    .svg-wrapper svg { width: 100%; height: auto; }

    /* 座席標準色 */
    g[id^="seat"] path,
    g[id^="seat"] rect {
      fill: #9fa0a0;
      transition: fill 0.15s, opacity 0.15s;
    }

    /* ハイライト */
    g[id^="seat"].is-current path,
    g[id^="seat"].is-current rect {
      fill: #1fa4ea;
      opacity: 1;
    }

    /* 除外席 */
    g[id^="seat"].is-disabled path,
    g[id^="seat"].is-disabled rect {
      fill: #e5e7eb;
      opacity: 0.35;
    }

    /* ボタン行 */
    .actions {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 14px;
    }

    .btn-main {
      padding: 12px 20px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      background: #1fa4ea;
      color: #fff;
      cursor: pointer;
    }

    /* 丸ボタン */
    .btn-retry {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: #e2e8f0;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    .icon-reload {
      width: 22px;
      height: 22px;
    }

    /* ローディング */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 20;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #d4d4d4;
      border-top-color: #1fa4ea;
      border-radius: 50%;
      animation: spin .8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body>

<div id="loadingOverlay" class="overlay">
  <div class="spinner"></div>
</div>

<main class="app">

  <div class="logo">
    <img src="title.svg" alt="SEKIGACHA">
  </div>

  <div class="svg-wrapper">
    <!-- ▼▼▼ あなたの seat01〜seat30 の SVG をここに丸ごと貼る ▼▼▼ -->
  </div>

  <section class="actions">
    <button id="btnMain" class="btn-main">ココジャナイ</button>

    <button id="btnReset" class="btn-retry" aria-label="全席リセット">
      <svg viewBox="0 0 24 24" class="icon-reload">
        <path
          d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6a6 6 0 1 1-6-6"
          fill="none"
          stroke="#475569"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>
  </section>

</main>

<!-- ▼ JS は body の最後に移動（重要！） ▼ -->
<script>
const LOADING_DELAY_MS = 700;
const overlayEl = document.getElementById("loadingOverlay");
const btnMain = document.getElementById("btnMain");
const btnReset = document.getElementById("btnReset");

function showLoading() {
  overlayEl.style.display = "flex";
  return new Promise(r => setTimeout(() => {
    overlayEl.style.display = "none";
    r();
  }, LOADING_DELAY_MS));
}

let currentSeatId = null;
const seats = [...document.querySelectorAll("g[id^='seat']")];

function pickRandomSeat() {
  const remaining = seats.filter(s => !s.classList.contains("is-disabled"));
  if (remaining.length === 0) return null;
  seats.forEach(s => s.classList.remove("is-current"));
  const seat = remaining[Math.floor(Math.random() * remaining.length)];
  seat.classList.add("is-current");
  currentSeatId = seat.id;
}

btnMain.addEventListener("click", async () => {
  await showLoading();
  if (currentSeatId) {
    const el = document.getElementById(currentSeatId);
    el.classList.add("is-disabled");
  }
  pickRandomSeat();
});

btnReset.addEventListener("click", async () => {
  await showLoading();
  seats.forEach(s => s.classList.remove("is-disabled", "is-current"));
  pickRandomSeat();
});

window.addEventListener("load", async () => {
  await showLoading();
  pickRandomSeat();
});
</script>

</body>
</html>
